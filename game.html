<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ</title>
  <style>
    body { font-family: 'Tahoma'; direction: rtl; background: #e9f0f7; padding: 20px; }
    input, button { padding: 10px; font-size: 16px; margin: 5px; }
    .box { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
    .attempt { background: #f0f0f0; padding: 8px; margin-top: 5px; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ <span id="playerName"></span></h2>
    <div id="gameArea" style="display:none;">
      <input type="text" id="guess" placeholder="Ø£Ø¯Ø®Ù„ ØªØ®Ù…ÙŠÙ†Ùƒ" maxlength="3">
      <button onclick="checkGuess()" id="checkBtn">ØªØ­Ù‚Ù‚</button>
      <div id="result"></div>
      <div id="attempts"></div>
    </div>
    <div id="error" style="color: red;"></div>
  </div>

  <script>
    let playerName = new URLSearchParams(window.location.search).get("player");
    document.getElementById("playerName").textContent = playerName || "Ø²Ø§Ø¦Ø±";

    const secret = localStorage.getItem("secretNumber");
    const currentVersion = localStorage.getItem("secretVersion");
    let storedVersion = currentVersion;

    if (!secret || secret.length !== 3) {
      document.getElementById("error").textContent = "ğŸš« Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.";
    } else {
      document.getElementById("gameArea").style.display = "block";
    }

    let startTime = new Date();

    function checkGuess() {
      const input = document.getElementById("guess").value;
      const result = document.getElementById("result");
      const attempts = document.getElementById("attempts");
      document.getElementById("guess").value = "";

      if (!/^[0-9]{3}$/.test(input)) {
        alert("Ø£Ø¯Ø®Ù„ 3 Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©");
        return;
      }

      let correct = 0;
      for (let i = 0; i < 3; i++) {
        if (input[i] === secret[i]) correct++;
      }

      let msg = "âŒ ÙˆÙ„Ø§ Ø±Ù‚Ù… ØµØ­";
      if (correct === 1) msg = "âœ… Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ØµØ­";
      if (correct === 2) msg = "âœ… Ø±Ù‚Ù…ÙŠÙ† ØµØ­";
      if (correct === 3) {
        const time = Math.floor((new Date() - startTime) / 1000);
        msg = `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ù„Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„\nğŸ•’ Ø§Ù„Ø²Ù…Ù†: ${time} Ø«Ø§Ù†ÙŠØ©`;
        document.getElementById("checkBtn").disabled = true;
      }

      const div = document.createElement("div");
      div.className = "attempt";
      div.textContent = `${input} â¤ ${msg}`;
      attempts.appendChild(div);
      result.textContent = msg;
    }

    // Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ
    setInterval(() => {
      const newVersion = localStorage.getItem("secretVersion");
      if (newVersion && newVersion !== storedVersion) {
        location.reload(); // Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø±Ù‚Ù…
      }
    }, 1000);
  </script>
</body>
</html>
